{
  "hash": "8cc3ac6f2b4ed2ad0dae93c68f581e71",
  "result": {
    "markdown": "---\ntitle: \"Prioritizing Potential Aquaculture\"\ndescription: \"This project's goal is to determine which Exclusive Economic Zones (EEZ) on the West Coast of the US are best suited to developing marine aquaculture for several species of oysters and red abalone.\"\nauthor:\n  - name: Kimmy Wong\n    url: https://kimberleewong.github.io/\n    affiliation: MEDS \n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 2024-12-07\nexecute: \n  warning: false\n  message: false\ncategories: [R, MEDS, Spatial-Analysis, Quarto]\ncitation: \n  url: https://kimberleewong.github.io/posts/prioritize_aquaculture/prioritizing_potential_aquaculture_blog.html\ntoc: true\nimage: aquaculture.jpg\ndraft: false\n---\n\n\n## Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(tmap)\nlibrary(here)\nlibrary(kableExtra)\nlibrary(usethis)\nlibrary(stars)\nlibrary(terra)\nlibrary(patchwork)\n```\n:::\n\n\n## Import Data\n\n\n::: {.cell quiet='true'}\n\n```{.r .cell-code}\n# Create a list of all images that have the extension .tif and contain \"sst\"\nsst_data <- list.files(here(\"posts\", \"prioritize_aquaculture\", \"data\"),\n                             pattern = \"sst\",\n                             full.names = TRUE)\n# Create a raster stack\nsst <- c(rast(sst_data))\n\n# Bathymetry\ndepth <- rast(here(\"posts\", \"prioritize_aquaculture\",\"data\",  \"depth.tif\"))\n\n# Exclusive Economic Zones\neez <- read_sf(here(\"posts\", \"prioritize_aquaculture\",\"data\", \"wc_regions_clean.shp\"))\n```\n:::\n\n\n## Check if CRS are the same\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(eez) == st_crs(depth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n\n```{.r .cell-code}\nst_crs(eez) == st_crs(sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n\n```{.r .cell-code}\nst_crs(sst) == st_crs(depth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n:::\n\n\n## Fix CRS to match\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsst <- project(sst, crs(depth))\n```\n:::\n\n\n## Check if CRS transformation worked\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a named list of CRS comparisons\ndf_crs_comparisons <- list(\n  \"sst vs depth\" = st_crs(sst) == st_crs(depth),\n  \"depth vs eez\" = st_crs(depth) == st_crs(eez)\n)\n\n# Identify mismatched CRS comparisons\nfalse_comparisons <- names(df_crs_comparisons)[!unlist(df_crs_comparisons)]\n\n# Print results or display warning\nif (length(false_comparisons) == 0) {\n  print(\"All CRS match.\")\n} else {\n  warning(paste(false_comparisons, collapse = \"; \"), \" CRS projections do not match.\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"All CRS match.\"\n```\n:::\n:::\n\n\n## Process Data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Find mean SST from 2008-2012 and make one raster\nsst_mean <- app(sst, fun = mean, na.rm = TRUE)\n\n# Convert average SST from Kelvin to Celsius\nsst_celsius <- sst_mean - 273.15\n\n# Crop depth raster to match extent of SST raster\ndepth_crop <- crop(depth, sst_celsius)\n\ndepth_resample <- resample(depth_crop, y = sst_celsius, method = \"near\")\n\n# Set CRS the same\ndepth_resample <- project(depth_resample, crs(sst))\n\n# Check that depth and SST match in resolution, extent and CRS\n\nif (identical(terra::res(depth_resample), terra::res(sst_celsius))) {\n  print(\"resolutions match\")\n} else {\n  print(\"resolutions don't match\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"resolutions match\"\n```\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nif (identical(terra::crs(depth_resample), terra::crs(sst_celsius))) {\n  print(\"crs match\")\n} else {\n  print(\"crs don't match\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"crs match\"\n```\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nif ((terra::ext(depth_resample) == terra::ext(sst_celsius))) {\n  print(\"ext match\")\n} else {\n  print(\"ext don't match\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"ext match\"\n```\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Stack sst_celsius and resampled depth\nsst_depth <- c(sst_celsius, depth_resample)\n```\n:::\n\n\n## Find suitable Location\n\nOysters require: - sea surface temperature: 11-30°C - depth: 0-70 meters below sea level\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Look at values\nsummary(sst_celsius)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      mean      \n Min.   : 7.02  \n 1st Qu.:12.39  \n Median :14.07  \n Mean   :14.16  \n 3rd Qu.:16.06  \n Max.   :32.72  \n NA's   :41907  \n```\n:::\n\n```{.r .cell-code}\nsummary(depth_resample)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     depth      \n Min.   :-5468  \n 1st Qu.:-4023  \n Median :-1703  \n Mean   :-1487  \n 3rd Qu.:  881  \n Max.   : 4112  \n```\n:::\n\n```{.r .cell-code}\n# Create sst reclassification matrix for sst\nrcl_sst <- matrix(c(-Inf, 11, NA, # min sst\n                    11, 30, 1, \n                    30, Inf, NA), # max sst\n                    ncol = 3, byrow = TRUE)\n\n# Use reclassification matrix to reclassify sst raster\nreclass_sst <- classify(sst_celsius, rcl = rcl_sst)\n\n\n# Create depth reclassification matrix\nrcl_depth <- matrix(c(-Inf, -70, NA, # min depth\n                    -70, 0, 1, \n                    0, Inf, NA), # max depth\n                    ncol = 3, byrow = TRUE)\n\n# Use reclassification matrix to reclassify depth raster\nreclass_depth <- classify(depth_resample, rcl = rcl_depth)\n\n# Check that it worked\nsummary(reclass_sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      mean      \n Min.   :1      \n 1st Qu.:1      \n Median :1      \n Mean   :1      \n 3rd Qu.:1      \n Max.   :1      \n NA's   :46153  \n```\n:::\n\n```{.r .cell-code}\nsummary(reclass_depth)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     depth      \n Min.   :1      \n 1st Qu.:1      \n Median :1      \n Mean   :1      \n 3rd Qu.:1      \n Max.   :1      \n NA's   :98798  \n```\n:::\n\n```{.r .cell-code}\n# Perform the operation: Both cells equal to 1\nsuit_loc <- (reclass_sst*reclass_depth)\n```\n:::\n\n\n## Determine most suitable EEZ\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find area of suitable cells \nsuit_area <- cellSize(x = suit_loc, # locations suitable\n                          mask = TRUE, # keeps NA \n                          unit = 'km')\n\n# Rasterize EEZ data\neez_raster <- rasterize(eez,\n                        suit_area, \n                        field = 'rgn') \n\n# Use zonal algebra to sum the suitable area by region\neez_suitable <- zonal(x = suit_area, \n                      z = eez_raster, # Raster representing zones\n                      fun = 'sum', \n                      na.rm = TRUE) \n\n# To map our eez area with geometry later on\neez <- left_join(eez, eez_suitable, by = \"rgn\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# View the area per region of suitable habitat for Oysters\nkable(eez_suitable, digits = 2,\n      caption = \"Total Suitable Area for Oysters by Exclusive Economic Zone\",\n      col.names = c(\"EEZ Region\", \"Area (km^2)\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n<caption>Total Suitable Area for Oysters by Exclusive Economic Zone</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> EEZ Region </th>\n   <th style=\"text-align:right;\"> Area (km^2) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Central California </td>\n   <td style=\"text-align:right;\"> 4939.80 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Northern California </td>\n   <td style=\"text-align:right;\"> 438.15 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oregon </td>\n   <td style=\"text-align:right;\"> 1533.07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Southern California </td>\n   <td style=\"text-align:right;\"> 3811.80 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Washington </td>\n   <td style=\"text-align:right;\"> 3224.69 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Visualize Suitable Areas with Bathymetry\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Plot regions and suitable areas together\ntm_shape(depth) +\n  tm_raster(palette = \"-Blues\",\n            title = \"Bathymetry\\n(m above/below sea level)\",\n            midpoint = 0,\n            legend.show = TRUE) +\n  tm_shape(eez) +\n  tm_polygons(fill = \"area\",\n              palette = \"YlGn\",\n              alpha = 0.65,\n              lwd = 0.2,\n              title = expression(\"Suitable habitat area (km\"^2*\")\")) +\n  tm_text(\"rgn\", size = 0.45) +\n  tm_compass(size = 1,\n             position = c(\"left\", \"top\")) +\n  tm_scale_bar(position = c(\"right\", \"top\")) +\n  tm_layout(legend.outside = TRUE,\n            frame = TRUE,\n            main.title = \"Suitable Habitats for Oysters by \\nWest Coast Exclusive Economic Zones\")\n```\n\n::: {.cell-output-display}\n![](prioritizing_potential_aquaculture_blog_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Function\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\naquaculture_function <- function(species, min_sst, max_sst,\n                                 min_depth, max_depth) {\n  \n# Create a list of all images that have the extension .tif and contain \"sst\"\nsst_data <- list.files(here(\"posts\", \"prioritize_aquaculture\",\"data\"),\n                             pattern = \"sst\",\n                             full.names = TRUE)\n# Create a raster stack\nsst <- c(rast(sst_data))\n\n# Bathymetry\ndepth <- rast(here(\"posts\", \"prioritize_aquaculture\",\"data\",  \"depth.tif\"))\n\n# Exclusive Economic Zones\neez <- read_sf(here(\"posts\", \"prioritize_aquaculture\",\"data\", \"wc_regions_clean.shp\"))\n\n# Match crs\nsst <- project(sst, crs(depth))\n\n# Find mean SST from 2008-2012 and make one raster\nsst_mean <- app(sst, fun = mean, na.rm = TRUE)\n\n# Convert average SST from Kelvin to Celsius\nsst_celsius <- sst_mean - 273.15\n\n# Crop depth raster to match extent of SST raster\ndepth_crop <- crop(depth, sst_celsius)\n\ndepth_resample <- resample(depth_crop, y = sst_celsius, method = \"near\")\n\n# Set CRS the same\ndepth_resample <- project(depth_resample, crs(sst))\n  \n# Create sst reclassification matrix for sst\nrcl_sst <- matrix(c(-Inf, min_sst, NA, # min sst\n                    min_sst, max_sst, 1, \n                    max_sst, Inf, NA), # max sst\n                    ncol = 3, byrow = TRUE)\n\n# Use reclassification matrix to reclassify sst raster\nreclass_sst <- classify(sst_celsius, rcl = rcl_sst)\n\n\n# Create depth reclassification matrix\nrcl_depth <- matrix(c(-Inf, min_depth, NA, # min depth\n                    min_depth, max_depth, 1, \n                    max_depth, Inf, NA), # max depth\n                    ncol = 3, byrow = TRUE)\n\n# Use reclassification matrix to reclassify depth raster\nreclass_depth <- classify(depth_resample, rcl = rcl_depth)\n\n# Perform the operation: Both cells equal to 1\nsuit_loc <- (reclass_sst*reclass_depth)\n\n# Find area of suitable cells \nsuit_area <- cellSize(x = suit_loc, # locations suitable\n                          mask = TRUE, # keeps NA \n                          unit = 'km')\n\n# Rasterize EEZ data\neez_raster <- rasterize(eez,\n                        suit_area, \n                        field = 'rgn') \n\n# Use zonal algebra to sum the suitable area by region\neez_suitable <- zonal(x = suit_area, \n                      z = eez_raster, # Raster representing zones\n                      fun = 'sum', \n                      na.rm = TRUE) \n\n# To map our eez area with geometry later on\neez <- left_join(eez, eez_suitable, by = \"rgn\")\n\n# Map of suitable areas \nmap <- tm_shape(depth) +\n  tm_raster(palette = \"-Blues\",\n            title = \"Bathymetry\\n(m above/below sea level)\",\n            midpoint = 0,\n            legend.show = TRUE) +\n  tm_shape(eez) +\n  tm_polygons(fill = \"area\",\n              palette = \"YlGn\",\n              alpha = 0.65,\n              lwd = 0.2,\n              title = expression(\"Suitable habitat area (km\"^2*\")\")) +\n  tm_text(\"rgn\", size = 0.45) +\n  tm_compass(size = 1,\n             position = c(\"left\", \"top\")) +\n  tm_scale_bar(position = c(\"right\", \"top\")) +\n  tm_layout(legend.outside = TRUE,\n            frame = TRUE,\n            main.title = paste(\"Suitable Habitats for\", species, \"by \\nWest Coast Exclusive Economic Zones\"))\n\n    \n  # Print map\n  return(map)\n}\n```\n:::\n\n\n## Use function for Red Abalone\n\nRed Abalone require: - sea surface temperature: 8-18°C - depth: 0-24 meters below sea level\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquaculture_function(species = \"Red Abalone\", \n                     min_sst = 8,\n                     max_sst = 18,\n                     min_depth = -24,\n                     max_depth = 0)\n```\n\n::: {.cell-output-display}\n![](prioritizing_potential_aquaculture_blog_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n# Data Citations\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Data </th>\n   <th style=\"text-align:left;\"> Citation </th>\n   <th style=\"text-align:left;\"> Link </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> SeaLife </td>\n   <td style=\"text-align:left;\"> Palomares, M.L.D. and D. Pauly. Editors. 2024. SeaLifeBase. World Wide Web electronic publication. www.sealifebase.org, version (08/2024) </td>\n   <td style=\"text-align:left;\"> [SeaLife (Red Abalone)](https://www.sealifebase.ca/summary/Haliotis-rufescens.html) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bathymetry </td>\n   <td style=\"text-align:left;\"> General Bathymetric Chart of the Oceans. (n.d.). Gridded bathymetry data (general bathymetric chart of the oceans). GEBCO. https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area </td>\n   <td style=\"text-align:left;\"> [Gridded Bathymetry Data](https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sea Surface Temperature </td>\n   <td style=\"text-align:left;\"> NOAA Coral Reef Watch. 2019, updated daily. NOAA Coral Reef Watch Version 3.1 Daily 5km Satellite Regional Virtual Station Time Series Data for Southeast Florida, Mar. 12, 2013-Mar. 11, 2014. College Park, Maryland, USA: NOAA Coral Reef Watch. Data set accessed 2020-02-05 at https://coralreefwatch.noaa.gov/product/vs/data.php. </td>\n   <td style=\"text-align:left;\"> [NOAA’s 5km Daily Global Satellite Sea Surface Temperature Anomaly v3.1](https://coralreefwatch.noaa.gov/product/5km/index_5km_ssta.php) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Economic Exclusive Zones </td>\n   <td style=\"text-align:left;\"> Marine regions. (n.d.). https://www.marineregions.org/eez.php </td>\n   <td style=\"text-align:left;\"> [Marineregions.org](https://www.marineregions.org/eez.php) </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "prioritizing_potential_aquaculture_blog_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}